<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ULTY Dividend & DRIP Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
  <h1>ULTY Dividend & DRIP Calculator</h1>

  <label>Shares:</label><input type="number" id="sharesInput" value="100" min="1">
  <label>DRIP:</label>
  <label class="switch"><input type="checkbox" id="dripSwitch"><span class="slider"></span></label>
  <button onclick="calculate()">Calculate</button>

  <div class="summary" id="summary"></div>
  <div id="result"></div>
  <p>Dividend data from YieldMax, prices from Yahoo Finance. Fractional shares allowed for DRIP. Verify before investing.</p>
</div>

<script>
let weeks = [];

async function loadData() {
  try {
    const res = await fetch("/.netlify/functions/ulty-data");
    weeks = await res.json();
    calculate();
  } catch(err) {
    console.error("Failed to load data", err);
    alert("Failed to load ULTY data.");
  }
}

function calculate() {
  if(!weeks || weeks.length === 0) return;

  const shares0 = parseFloat(document.getElementById('sharesInput').value) || 0;
  const drip = document.getElementById('dripSwitch').checked;
  if(shares0 < 1) { alert("Enter at least 1 share"); return; }

  let rows = "", totalCashDiv = 0, curShares = shares0, totalDiv = 0;

  for(let i=0;i<weeks.length;i++){
    const w = weeks[i];
    const div = w.dividend * curShares;
    totalDiv += div;

    if(drip){
      const addShares = div / w.close;
      curShares += addShares;
    } else {
      totalCashDiv += div;
    }

    rows += `<tr>
      <td>${w.week}</td>
      <td>${w.close.toFixed(2)}</td>
      <td>${w.dividend.toFixed(4)}</td>
      <td>${curShares.toFixed(4)}</td>
      <td>${div.toFixed(2)}</td>
      <td>${drip ? (curShares*w.close).toFixed(2) : "-"}</td>
    </tr>`;
  }

  const summaryText = drip 
    ? `DRIP ON: Final shares ${curShares.toFixed(4)}, portfolio value $${(curShares*weeks[weeks.length-1].close).toFixed(2)}, cumulative dividends reinvested $${totalDiv.toFixed(2)}`
    : `DRIP OFF: Cash dividends $${totalCashDiv.toFixed(2)}, final portfolio value $${(curShares*weeks[weeks.length-1].close).toFixed(2)}`;

  document.getElementById('summary').innerHTML = summaryText;

  document.getElementById('result').innerHTML = `<table>
    <tr><th>Week</th><th>Close</th><th>Dividend</th><th>Shares</th><th>Div Paid</th><th>DRIP Value</th></tr>${rows}
  </table>`;
}

window.onload = loadData;
</script>
</body>
</html>
